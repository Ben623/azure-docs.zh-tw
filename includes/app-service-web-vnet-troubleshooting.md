---
author: ccompy
ms.service: app-service-web
ms.topic: include
ms.date: 02/27/2020
ms.author: ccompy
ms.openlocfilehash: 2d2a82552a846cedfa5da3bb6ec6df8a40b67732
ms.sourcegitcommit: bc792d0525d83f00d2329bea054ac45b2495315d
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 03/06/2020
ms.locfileid: "78671527"
---
儘管功能易於設定，這不表示您的體驗不會遇到問題。 如果您在存取所需端點時遇到問題，有一些公用程式，您可以用來從應用程式主控台測試連線功能。 有兩個您可以使用的主控台。 一個是 Kudu 主控台，另一個則是 Azure 入口網站中的主控台。 若要從您的應用程式觸達 Kudu 主控台，請移至 [工具] -> [Kudu]。 您也可以連線到位於 [sitename]. azurewebsites. net 的 Kudo 主控台。 網站載入後，請移至 調試主控台 索引標籤。若要進入 Azure 入口網站裝載的主控台，請從您的應用程式移至 工具-> 主控台。 

#### <a name="tools"></a>工具
由於安全性限制，工具**ping**、 **nslookup**和**tracert**無法透過主控台來處理。 為了填滿 void，已加入兩個不同的工具。 為了測試 DNS 功能，已加入名為 nameresolver.exe的工具。 語法為：

    nameresolver.exe hostname [optional: DNS Server]

您可以使用 **nameresolver** 來檢查應用程式依賴的主機名稱。 如此一來您可以測試是否有任何項目未正確設定，而無法與 DNS 搭配，或可能對 DNS 伺服器沒有存取權。 您可以查看您的應用程式將在主控台中使用的 DNS 伺服器，方法是查看環境變數 WEBSITE_DNS_SERVER 並 WEBSITE_DNS_ALT_SERVER。

下一個工具可讓您測試主機是否可與 TCP 連線，以及連接埠組合。 此工具稱為 **tcpping**，語法如下：

    tcpping.exe hostname [optional: port]

**tcpping** 公用程式會讓您知道是否可以連接特定主機和連接埠。 只有在下列情況才會顯示成功：有一個應用程式監聽主機和連接埠組合，並且有網路從您的應用程式存取到指定的主機和連接埠。

#### <a name="debugging-access-to-vnet-hosted-resources"></a>偵錯 VNet 裝載資源的存取
有一些事物，可以阻止您的應用程式觸達特定的主機和連接埠。 大部分的情況下，會是下列三個情況的其中一種︰

* **路線中有防火牆。** 如果路線中有防火牆，則將會達到 TCP 逾時。 此案例中 TCP 逾時值就是 21 秒。 使用 **tcpping** 工具來測試連線能力。 TCP 逾時可能是因為許多項目越過防火牆並啟動。 
* **DNS 無法存取。** DNS 逾時值為三秒 (每部 DNS 伺服器)。 如果您有兩部 DNS 伺服器，逾時為 6 秒。 使用 nameresolver 來檢查 DNS 是否運作。 請記住，您不能使用 nslookup，因為它不會使用您的 VNet 設定使用的 DNS。 如果無法存取，您可能會有防火牆或 NSG 封鎖對 DNS 的存取，或可能已關閉。

如果這些專案不會回答您的問題，請先查看如下所示的內容： 

**區域 VNet 整合**
* 您的目的地是否為非 RFC1918 位址，而且您沒有 WEBSITE_VNET_ROUTE_ALL 設為1？
* 是否有 NSG 封鎖來自您整合子網的輸出？
* 如果跨 ExpressRoute 或 VPN 進行，您的內部部署閘道是否已設定為將流量備份至 Azure？ 如果您可以觸達 VNet 中的端點，但不能連線到內部部署，請檢查您的路由。
* 您有足夠的許可權可設定整合子網上的委派嗎？ 在區域 VNet 整合設定期間，您的整合子網將會委派給 Microsoft Web。 VNet 整合 UI 會自動將子網委派給 Microsoft Web。 如果您的帳戶沒有足夠的網路許可權來設定委派，您將需要可在整合子網上設定屬性以委派子網的人員。 若要手動委派整合子網，請移至 Azure 虛擬網路子網 UI，並設定適用于 Microsoft Web 的委派。 

**閘道所需的 VNet 整合**
* RFC 1918 範圍中的點對站位址範圍（10.0.0.0-10.255.255.255/172.16.0.0-172.31.255.255/192.168.0.0-192.168.255.255）？
* 閘道是否顯示為正在入口網站中啟動？ 如果您的閘道已關閉，請重新啟動。
* 憑證是否顯示為同步，或您是否懷疑網路設定已變更？  如果您的憑證未同步，或您懷疑 VNet 設定已變更，但未與您的 Asp 同步，則點擊 [同步網路]。
* 如果跨 VPN 進行，內部部署閘道是否已設定為將流量備份至 Azure？ 如果您可以觸達 VNet 中的端點，但不能連線到內部部署，請檢查您的路由。
* 您嘗試使用同時支援點對站和 ExpressRoute 的共存閘道嗎？ VNet 整合不支援共存閘道。

調試網路問題是一項挑戰，因為您無法看到封鎖存取特定主機：埠組合的原因。 部分原因包括：

* 您的主機上已啟動防火牆，因而無法從點對站 IP 範圍存取應用程式埠。 跨子網路通常需要公用存取權。
* 您的目標主機已關閉。
* 您的應用程式已關閉。
* 您的 IP 或主機名稱不正確。
* 您的應用程式正在接聽的埠與您所預期的不同。 您可以在端點主機上使用 "netstat -aon"，將處理序識別碼與接聽連接埠進行比對。 
* 您的網路安全性群組的設定方式，會使其無法從點對站 IP 範圍存取您的應用程式主機和埠。

請記住，您不知道應用程式會實際使用的位址。 它可以是整合子網或點對站位址範圍中的任何位址，因此您需要允許來自整個位址範圍的存取。 

其他偵錯步驟包括：

* 連線到您 VNet 中的 VM，並嘗試從該處連線到您的資源主機：埠。 若要測試 TCP 存取，請使用 PowerShell 命令 **test-netconnection**。 語法為：

      test-netconnection hostname [optional: -Port]

* 在 VM 上啟動應用程式，並使用**tcpping**從您的應用程式中的主控台測試該主機和埠的存取權

#### <a name="on-premises-resources"></a>內部部署資源 ####

如果您的應用程式無法連接內部部署資源，則請檢查您是否可以從 VNet 連接資源。 使用 **test-netconnection** PowerShell 命令來檢查是否有 TCP 存取權。 如果您的 VM 無法連線到您的內部部署資源，您的 VPN 或 ExpressRoute 連線可能未正確設定。

如果 VNet 裝載的 VM 可以連接您的內部部署系統，但您的應用程式無法連接此系統，則很可能是下列其中一個原因：

* 您的路由未設定您的子網，或在內部部署閘道中的點對站位址範圍。
* 您的網路安全性群組會封鎖點對站 IP 範圍的存取。
* 您的內部部署防火牆會封鎖來自點對站 IP 範圍的流量。
* 您正嘗試使用區域 VNet 整合功能來觸達非 RFC 1918 位址。