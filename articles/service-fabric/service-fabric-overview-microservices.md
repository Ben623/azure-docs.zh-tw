---
title: Azure 上的微服務簡介 | Microsoft Docs
description: 概述在現代應用程式開發中，為何使用微服務方法建置雲端應用程式很重要，以及 Azure Service Fabric 如何提供平台以達成此目標。
services: service-fabric
documentationcenter: .net
author: athinanthny
manager: chackdan
editor: ''
ms.assetid: fae2be85-0ab4-4cd3-9d1f-e0d95fe1959b
ms.service: service-fabric
ms.devlang: dotnet
ms.topic: conceptual
ms.tgt_pltfrm: NA
ms.workload: NA
ms.date: 06/18/2019
ms.author: atsenthi
ms.openlocfilehash: 5bcb52165c7cae18b807eff03c80b51eae8e2717
ms.sourcegitcommit: b7a44709a0f82974578126f25abee27399f0887f
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 06/18/2019
ms.locfileid: "67204799"
---
# <a name="why-use-a-microservices-approach-to-building-applications"></a>為何使用微服務方式建置應用程式？

適用於軟體開發人員，分解成元件部分的應用程式是什麼新玩意兒。 一般而言，一種分層的方法使用，以及後端存放區、 中間層商務邏輯和前端使用者介面 (UI)。 什麼*具有*過去幾年來的變化是開發人員建置分散式的雲端應用程式。

以下是一些變動的業務需求：

* 已建置並觸達新地理區域中的客戶大規模運作的服務。
* 更快速的功能和功能，以回應客戶的需求，靈活地傳遞。
* 提高資源使用率來降低成本。

這些商務需求會影響我們「如何」  建置應用程式。

如需有關 Azure 微服務方法的詳細資訊，請參閱[微服務：採用雲端技術的應用程式革命](https://azure.microsoft.com/blog/microservices-an-application-revolution-powered-by-the-cloud/)。

## <a name="monolithic-vs-microservices-design-approach"></a>整合型與微服務設計方法

應用程式會隨著時間而演化。 成功的應用程式因為有實用性而演化。 失敗的應用程式不發展，並最終已被取代。 以下是這個問題： 多少執行您現在了解您的需求，它們會在未來很嗎？ 例如，假設您要建置某部門的報告應用程式在您的公司。 您確定應用程式適用於只能在貴公司的範圍內，而且報表將不會保留的長。 您的方法就是不同的說，建置服務視訊內容傳遞給數千萬個客戶。

有時向外尋求概念證明才是驅動因素。 您知道應用程式可以在稍後重新設計。 有太大的工程過度複雜化的項目永遠不會取得使用。 相反地，當公司建置雲端時，預期會成長和使用量。 成長和範圍會無法預測。 我們想要的原型快速同時還要了解，我們在可以處理未來成功的路徑。 這是精簡的創業方法：建置、測量、學習及反覆執行。

在用戶端/伺服器時代，我們傾向專注於建立分層式應用程式使用每個層中的特定技術。 詞彙*單體式*應用程式已描述這些方法衍生出。 介面通常存在於各層之間，而在各層內的元件之間採用更緊密結合的設計。 開發人員設計並分解類別，已編譯成程式庫，並連結起來成為一些可執行檔和 Dll。

有許多優點，整合型設計的做法。 整合型應用程式通常用來設計、 更簡單，元件之間的呼叫會比較快，因為這些呼叫通常是透過處理序間通訊 (IPC)。 此外，所有人測試單一產品，通常是人力資源更有效率地使用。 缺點是分層式的層級之間的結合緊密，且您無法調整個別的元件。 如果您需要執行修正或升級，您必須等候其他人完成其測試。 它是很難敏捷式軟體開發。

微服務可解決這些缺點，更密切配合上述的商務需求。 但它們也有優點和責任。 微服務的優點在於其通常會封裝較簡單的商務功能，因此您可以獨立地對它們進行相應增加或減少、測試、部署，以及管理。 微服務方法的一個重要優點是團隊會驅動商務案例的更多的技術。 較小的小組開發的客戶案例為基礎的微服務，並使用他們想要使用的任何技術。

換句話說，組織不需要為了維護微服務應用程式而將技術標準化。 擁有服務的個別團隊可以根據團隊的專業知識，或什麼是最適合所要解決的問題，各自發揮所長。 在實務上，一組建議的技術，例如特定的 NoSQL 存放區或 web 應用程式架構，最好。

微服務的缺點是，您必須管理多個個別的實體，以及處理更複雜的部署和版本控制。 微服務之間的網路流量增加時，如同對應的網路延遲。 許多多對話且細微的服務可能會導致效能夢魘的解決。 沒有工具可協助您檢視這些相依性，就很難看到整個系統項目。

標準會讓微服務方法，藉由指定的通訊方式，並容許只在乎您需要從服務中，工作而不是僵固的合約。 請務必在設計中定義這些合約，因為服務彼此獨立地更新。 另一個在設計微服務方法時出現的描述是「細緻的服務導向架構 (SOA)」。

***簡單來說，微服務設計方法是低耦合的服務同盟，各自獨立變更和同意標準的通訊。***

隨著更多的雲端應用程式產生，人們發現這種分解成獨立、 案例焦點式服務的整體應用程式是更好的長期的方法。

## <a name="comparison-between-application-development-approaches"></a>應用程式開發方法的比較

![Service Fabric 平台應用程式開發][Image1]

1) 單體式應用程式包含領域特定功能，而且通常分成功能層級，例如 web、 商務和資料。

2) 您可藉由複製到多個伺服器/虛擬機器上調整整合型應用程式/容器。

3) 微服務應用程式會將個別功能分隔成個別較小的服務。

4) 微服務方法可獨立部署每個服務而相應放大，跨伺服器/虛擬機器/容器建立這些服務的執行個體。

使用微服務設計方法並不適用於所有專案，但確實更接近稍早所述的商務目標。 從使用單體式方法開始合理如果您知道您將有機會將程式碼修改為微服務設計的更新版本。 較常見的情況是您從單體式應用程式開始著手，然後從需要更高調整性或靈活度的功能領域開始，分階段緩慢地將它拆解。

當您使用微服務方法時，您會撰寫您的應用程式的許多小型服務。 這些服務會在部署於電腦叢集的容器中執行。 較小的團隊會開發著重於某個案例的服務和獨立測試版本、 部署及調整每個服務，讓整個應用程式就能持續改進的資料。

## <a name="what-is-a-microservice"></a>什麼是微服務？

有不同的微服務定義。 不過，大部分的微服務的這些特性會被廣泛接受：

* 封裝客戶或商務案例。 您解決什麼問題？
* 由小型工程團隊開發。
* 以任何程式設計語言，使用任何架構。
* 包含程式碼，以及 （選擇性） 狀態，這兩者都是獨立控制版本、 部署及調整。
* 透過定義完善的介面和通訊協定，與其他微服務互動。
* 具有用來解析其位置的唯一名稱 (Url)。
* 在失敗時維持一致且可用的。

總而言之，：

***微服務應用程式是由獨立控制版本和可調整的客戶焦點式服務所組成，這些服務透過標準通訊協定和定義完善的介面彼此通訊。***

### <a name="written-in-any-programming-language-using-any-framework"></a>以任何程式設計語言，使用任何架構

身為開發人員，我們想要可自由選擇的語言或架構，根據本身的技術和服務，我們要建立的需求而定。 某些服務中，您可能值的效能優勢C++上述任何其他項目。 對於其他人，方便您從取得的 managed 開發C#或 Java 可能更為重要。 在某些情況下，您可能需要使用特定的協力廠商程式庫、 資料儲存技術或方法來公開給用戶端服務。

您選擇技術之後，您需要考慮操作或生命週期管理和調整服務。

### <a name="allows-code-and-state-to-be-independently-versioned-deployed-and-scaled"></a>允許獨立控制版本、部署及調整的程式碼和狀態

不論您如何撰寫您的微服務、 程式碼，以及 （選擇性） 狀態，應該獨立部署、 升級和調整。 這個問題很難解決因為這涉及到您選擇的技術。 調整，了解如何分割 （或分區） 的程式碼和狀態是一項挑戰。 當程式碼和狀態使用不同的技術，這是常見的今日，您的微服務的部署指令碼必須能夠調整兩者。 這種區隔也是關乎靈活度和彈性，因此您可以升級部分微服務而不必一次全部升級。

讓我們回到我們的時刻的單體式和微服務方法的比較。 下圖顯示儲存狀態的方法中的差異：

#### <a name="state-storage-for-the-two-approaches"></a>兩種方法狀態儲存體

![Service Fabric 平台狀態儲存體][Image2]

***單體式方法中，在左邊，有一個單一資料庫和多層的特定技術。***

***微服務方法中，在右側，有圖形顯示互連的微服務，其中狀態通常以微服務為範圍，並會使用各種技術。***

在單體式方法中，應用程式通常會使用單一資料庫。 使用一個資料庫的優點是它是在單一位置，可讓您更容易部署。 每個元件可以有單一資料表來儲存其狀態。 挑戰之處在於團隊必須嚴格區分狀態。 無可避免地，有人會想要加入至現有的客戶資料表的資料行、 資料表之間的聯結作業，並建立儲存層的相依性。 發生這種情況後，您無法調整個別的元件。

在微服務方法中，每個服務都會管理並儲存自己的狀態。 每個服務負責同時調整程式碼和狀態，以滿足服務的需求。 缺點是，當您需要建立檢視或查詢，您的應用程式資料，您需要跨多個狀態存放區進行查詢。 通常由個別的微服務可跨微服務的集合中建立檢視之後，即可解決此問題。 如果您需要對資料執行多個即席查詢，您應該考慮將每個微服務的資料寫入至資料倉儲服務，供離線分析。

微服務的版本。 可以針對不同版本的並存執行微服務。 新版的微服務無法在升級期間失敗，而且需要回復至舊版。 版本控制也很有用的 A / B 測試，其中不同的使用者體驗到不同版本的服務。 比方說，常會升級的一組特定客戶來測試新的功能，然後再發送更廣泛的微服務。

### <a name="interacts-with-other-microservices-over-well-defined-interfaces-and-protocols"></a>透過定義完善的介面和通訊協定，與其他微服務互動

在過去 10 年來，廣泛的資訊已發行描述服務導向架構中的通訊模式。 一般而言，服務通訊使用 REST 方法，並搭配 HTTP 和 TCP 通訊協定及 XML 或 JSON 做為序列化格式。 從介面觀點來看，它是有關採用 web 設計方法。 但是，不應該讓您無法使用二進位通訊協定或您自己的資料格式。 只要留意人們將擁有更難使用您的微服務，如果這些通訊協定和格式無法公開使用的時間。

### <a name="has-a-unique-name-url-used-to-resolve-its-location"></a>具有可用來解析位置的唯一名稱 (URL)

您的微服務必須是可定址的只要它正在執行。 如果您正在考慮機器及哪一個執行特定的微服務，項目可以急遽惡化。

就像 DNS 會解析特定電腦的特定 URL 一樣，微服務需要有唯一的名稱，其目前所在的位置才可被探索。 微服務需要可定址的名稱，都是獨立的執行所在的基礎結構。 這表示沒有之間如何部署您的服務和探索方式，因為需要有服務登錄。 當電腦故障時，登錄服務必須告訴您該服務已移至。

### <a name="remains-consistent-and-available-in-the-presence-of-failures"></a>失敗時維持一致且可用

處理非預期的失敗是最難解決的問題之一，特別是在分散式系統中。 大部分開發人員撰寫的程式碼會處理例外狀況。 在測試期間，我們也花最多時間在例外狀況處理。 此程序會比撰寫程式碼來處理失敗更為複雜。 微服務執行所在的電腦失敗時，會發生什麼事？ 您要偵測到失敗，也就是在它自己的難題。 但您也需要重新啟動您的微服務。

如需可用性，微服務必須從失敗中復原，以在另一部電腦上重新啟動。 除了這些的復原需求，資料應該不會遺失，而且資料必須維持一致。

如果在應用程式升級期間發生失敗，會使復原性很難達成。 在搭配部署系統一起運作時，微服務不需要復原。 它需要決定是否可以繼續向前移到較新版本，或回復至先前的版本，以維護一致的狀態。 您必須考慮幾個問題，例如足夠的電腦是否可繼續升級，以及如何復原舊版的微服務。 若要做出這些決定，您會需要微服務發出健康情況資訊。

### <a name="reports-health-and-diagnostics"></a>報告狀況和診斷

它可能就很明顯，常被忽略，但微服務必須報告其健全狀況和診斷。 否則，您必須從作業觀點來看其健全狀況的深入。 相互關聯一組獨立服務上的診斷事件，並處理電腦時間差異以了解事件順序，是一件非常具挑戰性的任務。 與您透過同意的通訊協定和資料格式來與微服務互動相同，您需要將健康情況和診斷事件的記錄方式標準化，因為這些事件最後會被放入事件存放區中以供查詢和檢視。 使用微服務方法時，不同的小組需要同意單一記錄格式。 需要有一致的方法可檢視整個應用程式中的診斷事件。

狀況與診斷不同。 健全狀況是指微服務報告其目前狀態，以便採取適當的行動。 使用升級和部署機制來維護可用性是一個很好例子。 雖然服務可能是因為處理序損毀的目前狀況不良，或重新開機，服務可能仍會運作。 開始升級讓情況更糟的是為您所需要的最後一件事。 最好的方法是先調查或讓微服務，可復原的時間。 微服務的健全狀況事件可協助我們做出明智的決策，實際上有助於建立自我修復的服務。

## <a name="guidance-for-designing-microservices-on-azure"></a>設計微服務在 Azure 上的指引 
造訪 Azure 架構中心指引[設計和建置在 Azure 上的微服務](https://docs.microsoft.com/azure/architecture/microservices/)。

## <a name="service-fabric-as-a-microservices-platform"></a>Service Fabric 做為微服務平台

Azure Service Fabric 源自於 Microsoft 從提供盒裝的產品，通常是單體，到提供服務的轉換時。 建置和操作大型服務，例如 Azure SQL Database 和 Azure Cosmos DB 的經驗圖形化 Service Fabric。 如需詳細的服務採用隨時間而變化的平台。 Service Fabric 不僅必須在 Azure 中執行，也必須在獨立式 Windows Server 部署中執行。

***Service Fabric 的目標是解決建置和執行服務的艱難的問題並有效地使用基礎結構資源，讓小組可以使用微服務方法解決商務問題。***

Service Fabric 透過提供下列項目，來協助您使用微服務方法建置應用程式：

* 一個提供系統服務的平台 - 這些服務可進行部署、升級、偵測及重新啟動失敗的服務、探索服務、路由傳送訊息、管理狀態，以及監視健康情況。
* 部署應用程式容器中或做為處理序： 執行的能力。 Service Fabric 是一個容器和處理序協調者。
* 高生產力程式設計 Api，用來協助您建置成微服務的應用程式：[ASP.NET Core、Reliable Actors 及 Reliable Services](service-fabric-choose-framework.md)。 例如，您可以取得健康情況和診斷資訊，或利用內建的高可用性。

***關於如何建置您的服務，Service Fabric 無關，而且您可以使用任何技術。但是，它提供內建的程式設計 Api，讓您更輕鬆地建置微服務。***

### <a name="migrating-existing-applications-to-service-fabric"></a>將現有的應用程式移轉到 Service Fabric

Service Fabric 可讓您重複使用現有的程式碼，並將它與新的微服務的現代化。 有應用程式的現代化的五個階段，您可以啟動和停止每一個階段。 階段是：

1) 開始使用傳統單體式應用程式。  
2) 移轉。 使用容器或來賓可執行檔來裝載 Service Fabric 中的現有程式碼。  
3) 現代化。 加入新的微服務與現有的容器化程式碼。  
4) 創新。 整合型應用程式分成需求為基礎的微服務。  
5) 轉換成微服務的應用程式。 轉換現有的單體式應用程式，或建立新的原創應用程式。

![移轉微服務][Image3]

請記住，您可以*在當中任何階段開始和停止*。 您不需要進行至下一個階段。 

讓我們看看範例的每個階段。

**移轉**  
基於兩個理由，許多公司都要移轉現有的單體式應用程式，在容器：

* 降低成本，可能是因為合併和移除現有的硬體或執行應用程式在更高的密度。
* 開發與作業之間的一致性部署合約。

降低成本是直接了當。 在 Microsoft，許多現有的應用程式都正透過容器化，導致節省數百萬美元。 一致性部署較難以評估，但同樣重要。 這表示，開發人員可以選擇的技術，符合它們，但是作業會接受單一方法來部署及管理應用程式。 它可減輕作業的處理支援不同的技術，不強迫開發人員可以選擇只將特定技術的複雜性。 基本上，每個應用程式是透過容器化成為獨立性的部署映像。

許多組織都在此停止。 他們已經有容器的優點和 Service Fabric 會提供完整的管理體驗，包括部署、 升級、 版本控制、 復原、 和健全狀況監視。

**現代化**  
現代化，是加入新的服務與現有的容器化程式碼。 如果您要撰寫新程式碼，最好是採取小型微服務的路徑下的步驟。 這可能表示新增新的 REST API 端點或新的商務邏輯。 如此一來，您可以開始建置新微服務，以及練習開發和部署程序。

**創新**  
微服務方式能容納持續變更的商務需求。 在這個階段，您必須決定是否要開始分割單體式應用程式服務，或進行創新。 一個典型的範例時，您用來作為工作流程佇列的資料庫會變成處理瓶頸。 隨著工作流程要求數目的增加，將需要分配工作來進行調整。 需要這部分的應用程式，不能擴充，或需要更頻繁地更新並將它分割為微服務及創新。

**轉換成微服務的應用程式**  
在這個階段，您的應用程式是完全組成 （或分成） 微服務。 若要達到這個點，您所做的微服務旅程圖。 您可以從這裡開始，但若要這樣做沒有用微服務平台，可協助您需要大量投資。

### <a name="are-microservices-right-for-my-application"></a>微服務適合我的應用程式嗎？

可能。 在 Microsoft，隨著更多小組開始建置雲端商務原因，其中有許多實現採用類似微服務的方法的優點。 Bing，比方說，有已使用微服務一年。 對於其他團隊而言，微服務方法很新穎。 團隊發現在他們的核心強項之外，還有需要解決的困難問題。 這就是為什麼 Service Fabric 重視而成為建置服務的技術。

Service Fabric 的目標是減少建置微服務應用程式，讓您不需要經歷多個高成本的重新設計的複雜性。 從小規模開始、需要時調整、淘汰服務、加入新服務，並隨客戶使用情況而演化。 我們也知道，為了讓微服務更易於為大部分開發人員所接受，還有許多其他尚待解決的問題。 容器和 actor 程式設計模型是簡單的步驟，在該方向中的範例。 我們確定更多創新便會浮現讓微服務方法更容易。


## <a name="next-steps"></a>後續步驟

* [微服務：採用雲端技術的應用程式革命](https://azure.microsoft.com/blog/microservices-an-application-revolution-powered-by-the-cloud/)
* [Azure Architecture Center:在 Azure 上建置微服務](https://docs.microsoft.com/azure/architecture/microservices/)
* [Azure Service Fabric 應用程式和叢集的最佳作法](service-fabric-best-practices-overview.md)
* [Service Fabric 術語概觀](service-fabric-technical-overview.md)

[Image1]: media/service-fabric-overview-microservices/monolithic-vs-micro.png
[Image2]: media/service-fabric-overview-microservices/statemonolithic-vs-micro.png
[Image3]: media/service-fabric-overview-microservices/microservices-migration.png
