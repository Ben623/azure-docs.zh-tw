---
title: Azure IoT 中樞的裝置設定最佳做法 | Microsoft Docs
description: 了解大規模設定 IoT 裝置的最佳做法
author: chrisgre
ms.author: chrisgre
ms.date: 06/24/2018
ms.topic: conceptual
ms.service: iot-hub
services: iot-hub
ms.openlocfilehash: c97395981ea3af90c7b0c590cb049fccc7392304
ms.sourcegitcommit: d4dfbc34a1f03488e1b7bc5e711a11b72c717ada
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 06/13/2019
ms.locfileid: "60734825"
---
# <a name="best-practices-for-device-configuration-within-an-iot-solution"></a>IoT 解決方案內的裝置設定最佳做法

Azure IoT 中樞內的自動裝置管理，可將管理大量裝置機群的許多重複且複雜的工作自動化，並且管理範圍橫跨裝置的完整生命週期。 本文將定義與開發和操作 IoT 解決方案有關的不同角色所適用的多種最佳做法。

* **IoT 硬體製造商/整合者：** IoT 硬體，整合者組裝來自各個製造商或針對 IoT 部署提供硬體的供應商的硬體製造商製造或整合其他供應商。 參與韌體、內嵌的作業系統和內嵌軟體的開發和整合。

* **IoT 解決方案開發人員：** IoT 解決方案的開發通常是由方案開發人員。 此開發人員可能是內部團隊的成員，或是專精於此活動的系統整合者。 IoT 解決方案開發人員可從頭開始開發 IoT 解決方案的各種元件、整合各種標準或開放原始碼元件，或自訂 [IoT 解決方案加速器](/azure/iot-accelerators/)。

* **IoT 解決方案操作人員：** IoT 解決方案部署之後，它會需要長時間操作、 監視、 升級及維護。 這些工作都可由內部團隊來完成，而內部團隊是由資訊技術專家、硬體作業及維護團隊，以及負責監督整體 IoT 基礎結構是否正確運作的網域專家所組成。

## <a name="understand-automatic-device-management-for-configuring-iot-devices-at-scale"></a>了解大規模設定 IoT 裝置所適用的自動裝置管理

自動裝置管理具有[裝置對應項](iot-hub-devguide-device-twins.md)和[模組對應項](iot-hub-devguide-module-twins.md)方面的多項優點，可雲端與裝置之間同步處理所需和報告的狀態。 [自動裝置組態](iot-hub-auto-device-config.md)自動更新大量的對應項，並提供進度和合規性摘要。 下列主要步驟說明如何開發和使用自動裝置管理：

* **IoT 硬體製造商/整合者**使用[裝置對應項](iot-hub-devguide-device-twins.md)在內嵌的應用程式中實作裝置管理功能。 這些功能可包括韌體更新、軟體安裝與更新，以及設定管理。

* **IoT 解決方案開發人員**使用[裝置對應項](iot-hub-devguide-device-twins.md)和[自動裝置設定](iot-hub-auto-device-config.md)實作裝置管理作業的管理層。 解決方案中應定義用以執行裝置管理工作的操作員介面。

* **IoT 解決方案操作員**使用 IoT 解決方案執行裝置管理工作，尤其是將裝置分組、起始組態變更 (例如韌體更新)、監視進度，以及對產生的問題進行疑難排解。

## <a name="iot-hardware-manufacturerintegrator"></a>IoT 硬體製造商/整合者

以下是負責處理內嵌軟體開發的硬體製造商與整合者所適用的最佳做法：

* **實作[攣生裝置](iot-hub-devguide-device-twins.md):** 裝置對應項可讓同步處理所需的設定從雲端以及報告目前的設定和裝置屬性。 在內嵌的應用程式中實作裝置對應項的最佳方式，是透過 [Azure IoT SDK](https://github.com/Azure/azure-iot-sdks) 來執行。 裝置對應項是進行設定的最佳途徑，因為它們：

    * 支援雙向通訊。
    * 允許連線和中斷連線的裝置狀態。
    * 遵循最終一致性的原則。
    * 在雲端中可供完整查詢。

* **結構的裝置管理的裝置對應項：** 應該結構化的裝置對應項，使裝置管理的內容會以邏輯方式分組放入各節。 此作法可讓組態變更受到隔離，而不會影響到對應項的其他區段。 例如，在韌體的所需屬性內建立一個區段，為軟體建立另一個區段，並為網路設定建立第三個區段。 

* **適用於裝置管理的報告裝置屬性：** 屬性，例如實體裝置廠牌與型號，則表示韌體、 作業系統、 序號和其他識別項是可用來報告，以及做為目標的組態變更的參數。

* **定義狀態和進度報告的主要狀態：** 應該列舉最上層的狀態，以便它們可以報告給操作員。 例如，軔體更新會報告「目前」、「下載中」、「套用中」、「進行中」和「錯誤」等狀態。 定義其他欄位以提供每個狀態的詳細資訊。

## <a name="iot-solution-developer"></a>IoT 解決方案開發人員

以下是以 Azure 為基礎建置系統的 IoT 解決方案開發人員所適用的最佳做法︰

* **實作[攣生裝置](iot-hub-devguide-device-twins.md):** 裝置對應項可讓同步處理所需的設定從雲端以及報告目前的設定和裝置屬性。 在雲端解決方案應用程式中實作裝置對應項的最佳方式，是透過 [Azure IoT SDK](https://github.com/Azure/azure-iot-sdks) 來執行。 裝置對應項是進行設定的最佳途徑，因為它們：

    * 支援雙向通訊。
    * 允許連線和中斷連線的裝置狀態。
    * 遵循最終一致性的原則。
    * 在雲端中可供完整查詢。

* **組織使用裝置對應項標記的裝置：** 解決方案應該允許操作員定義品質環形或其他組的各種不同的部署策略，例如 canary 為基礎的裝置。 裝置組織可以使用裝置對應項標記和[查詢](iot-hub-devguide-query-language.md)在您的解決方案中實作。 必須仰賴裝置組織，才能安全且精確地推出設定。

* **實作[自動裝置組態](iot-hub-auto-device-config.md):** 自動裝置設定部署和監視設定變更到大量 IoT 裝置透過裝置對應項。 自動裝置設定可透過**目標條件** (這是對裝置對應項標記或報告屬性的查詢) 將多組裝置對應項設為目標。 **目標內容**是將在目標裝置對應項內設定的一組所需屬性。 目標內容應與 IoT 硬體製造商/整合者所定義的裝置對應項結構相一致。

   **計量**是對裝置對應項報告屬性的查詢，也應與 IoT 硬體製造商/整合者所定義的裝置對應項結構相一致。 自動裝置設定的優點還包括 IoT 中樞在執行裝置對應項作業時，速率絕不會超過裝置對應項讀取和更新的[節流限制](iot-hub-devguide-quotas-throttling.md)。

* **使用[裝置佈建服務](../iot-dps/how-to-manage-enrollments.md):** 方案開發人員應該使用 「 裝置佈建服務將裝置對應項標籤指派給新的裝置，使它們會自動設定**自動裝置組態**的適用對象是具有該標記的對應項。 

## <a name="iot-solution-operator"></a>IoT 解決方案操作人員

以下是使用 Azure 架構 IoT 解決方案的 IoT 解決方案操作員所適用的最佳做法︰

* **組織管理的裝置：** IoT 解決方案應該定義，或允許建立品質環形或其他集合的各種不同的部署策略，例如 canary 為基礎的裝置。 這些裝置集合將用來推出組態變更，以及執行其他大規模的裝置管理作業。

* **執行使用分階段進行組態變更：** 階段式的推出是操作員將變更部署至一組 broadening IoT 裝置的其中一個整體程序。 目標是逐漸進行變更，以降低進行大規模重大變更的風險。  操作員應使用解決方案的介面來建立[自動裝置設定](iot-hub-auto-device-config.md)，且目標條件應以初始的裝置集合 (例如 Canary 群組) 為目標。 接著，操作員應驗證初始裝置集合中的組態變更。

   驗證完成後，操作員將更新自動裝置設定，以納入更大的裝置集合。 操作員也應為該組態設定比目前用於這些裝置的其他組態更高的優先順序。 推出的情形可使用自動裝置設定所報告的計量來監視。

* **執行回復，如果發生錯誤或不正確的設定：** 會導致錯誤或不正確的設定自動裝置組態可以回復變更**目標條件**使裝置不再符合目標條件。 請確定優先順序較低的另一個自動裝置設定仍以這些裝置為目標。 確認復原成功檢視度量：復原組態應該不會再顯示無目標的裝置狀態和第二個設定的計量現在應該包含裝置仍然設為目標的計數。

## <a name="next-steps"></a>後續步驟

* 在[了解和使用 Azure IoT 中樞的裝置對應項](iot-hub-devguide-device-twins.md)中了解如何實作裝置對應項。

* 逐步執行[大規模設定和監視 IoT 裝置](iot-hub-auto-device-config.md)中用來建立、更新或刪除自動裝置設定的步驟。

* 實作韌體更新模式使用裝置對應項和中的自動裝置組態[教學課程：實作裝置韌體更新程序](tutorial-firmware-update.md)。
