---
title: 選擇散發資料行中的 Azure 資料庫，適用於 PostgreSQL 超大規模 (Citus) （預覽）
description: 很好的選擇，超大規模的常見案例中的散發資料行
author: jonels-msft
ms.author: jonels
ms.service: postgresql
ms.subservice: hyperscale-citus
ms.topic: conceptual
ms.date: 05/06/2019
ms.openlocfilehash: e9fba14b8979f739fd29bc277e32fb544221d08a
ms.sourcegitcommit: d4dfbc34a1f03488e1b7bc5e711a11b72c717ada
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 06/13/2019
ms.locfileid: "65078981"
---
# <a name="choose-distribution-columns-in-azure-database-for-postgresql--hyperscale-citus-preview"></a>選擇散發資料行中的 Azure 資料庫，適用於 PostgreSQL 超大規模 (Citus) （預覽）

選擇每個資料表的散發資料行就**其中一個最重要**模型化決策。 超大規模儲存在資料列的散發資料行的值為基礎的分區中的資料列。

正確的選擇群組的相關資料一起在相同的實體節點，讓查詢所有的 SQL 功能的快速且新增支援。 不正確的選擇可讓系統將會執行速度變慢，並不會支援所有的 SQL 功能，跨節點。

本節提供兩種最常見的超大規模案例散發資料行的秘訣。

### <a name="multi-tenant-apps"></a>多租用戶應用程式

多租用戶架構會使用一種階層式的資料庫的伺服器群組中的節點之間分散查詢模型。  資料階層的頂端就所謂*租用戶識別碼*，而且必須儲存在每個資料表的資料行。

超大規模會檢查以查看哪一個租用戶識別碼，它們、 加入並尋找相符的資料表分區的查詢。 它會將查詢傳送至單一背景工作節點，其中包含分區中。 包含所有相關的資料放在相同節點上執行的查詢稱為 「 共置。

下圖說明多租用戶資料模型中的共置。 它包含兩個資料表的帳戶和行銷活動，每個散發的`account_id`。 陰影的方塊代表每個色彩表示哪一個背景工作節點包含它的分區。 綠色的分區會一起儲存在一個背景工作節點，而另一個藍色。 請注意帳戶與活動之間的聯結查詢會有所有必要的資料一起在一個節點上的同一個帳戶來限制這兩個資料表時\_識別碼。

![多租用戶共置](media/concepts-hyperscale-choosing-distribution-column/multi-tenant-colocation.png)

若要套用這項設計您自己的結構描述中，找出您的應用程式中的租用戶的構成項目。 常見的執行個體包含公司、 帳戶、 組織或客戶。 資料行名稱會類似`company_id`或`customer_id`。 檢查每個查詢，並自問： 會使用具有額外的 WHERE 子句，以限制為相同的租用戶識別碼的資料列相關的所有資料表？
在多租用戶模型中的查詢範圍的租用戶、 銷售或存貨的查詢會執行個體範圍內特定的存放區。

#### <a name="best-practices"></a>最佳做法

-   **資料分割散發資料表，由常見的租用戶\_識別碼資料行。** 例如，在租用戶所在公司而言，租用戶 SaaS 應用程式\_識別碼可能會有公司\_識別碼。
-   **將跨租用戶的小型資料表轉換成參考資料表中。** 當多個租用戶共用資訊的小型資料表時，請將它發佈為參考資料表。
-   **租用戶的所有應用程式查詢的篩選限制\_識別碼。** 每個查詢都應該要求一次一個租用戶資訊。

讀取[多租用戶教學課程](./tutorial-design-database-hyperscale-multi-tenant.md)建置這類應用程式的範例。

### <a name="real-time-apps"></a>即時應用程式

多租用戶架構引進了階層式結構，並使用為每個租用戶的路由查詢的資料共置。 相較之下，即時架構而定的達成高度平行處理資料的特定發佈內容。

我們可以使用 「 實體識別碼 」 作為散發資料行，在即時的模型中的詞彙。 典型的實體是使用者、 主機或裝置。

即時查詢通常會尋求依日期或類別目錄分組的數值彙總。 超大規模將這些查詢傳送至每個分區的部分結果，並將最後的解組合上的協調器節點。 查詢不執行速度最快當如同許多節點參與越好，以及任何單一節點必須執行到不當比例的工作。

#### <a name="best-practices"></a>最佳做法

-   **選擇資料行具有高基數為散發資料行。** 相較之下，如\"狀態\"訂單資料表，其中 「 新 」 的值上的欄位 「 付費 」 和 「 已出貨 」 很好的選擇的散發資料行。 它假設只有這些幾個值，這會限制可以保存資料的分區數目，以及可以處理它的節點數目。 之間具有高基數的資料行，您最好另外選擇經常使用 group by 子句中或做為聯結索引鍵。
-   **選擇具有平均分佈的資料行。** 如果要散發扭曲成特定的通用值的資料行上的資料表，資料表中的資料會傾向累積在特定的分區中。 保留這些分區的節點最後會執行多個工作超過其他節點。
-   **將依一般的資料行的事實和維度資料表。**
    事實資料表可以有一個散發索引鍵。 加入另一個索引鍵的資料表將不會與事實資料表共置。 選擇一個維度共置聯結的頻率和聯結的資料列的大小為基礎。
-   **變更一些維度資料表到參考資料表中。** 如果維度資料表不能與事實資料表共置，您就可以改善查詢效能的維度資料表的形式參考資料表中的節點的所有複本散發。

讀取[即時儀表板的教學課程](./tutorial-design-database-hyperscale-realtime.md)建置這類應用程式的範例。

### <a name="timeseries-data"></a>時間序列資料

在時間序列的工作負載，應用程式會查詢最近的資訊，同時封存舊的資訊。

最常見的錯誤中的超大規模的 timeseries 資訊模型化使用本身的時間戳記作為散發資料行。 時間為基礎的雜湊散發會分配時間似乎隨機到不同的分區，而不是在分區中保留的時間範圍在一起。 通常涉及時間的查詢參考的時間範圍 （例如最新的資料），因此這類的雜湊散發會導致網路負荷。

#### <a name="best-practices"></a>最佳做法

-   **請勿選擇作為散發資料行的時間戳記。** 選擇不同的散發資料行。 在多租用戶應用程式使用租用戶識別碼，或在即時應用程式中使用 實體識別碼。
-   **使用 PostgreSQL 資料表的資料分割時間改為。** 使用資料表資料分割來按時間排序資料的大型資料表分成多個繼承的資料表，與每個包含不同的時間範圍。  散發在超大規模 Postgres 分割資料表會建立繼承資料表的分區。

讀取[timeseries 教學課程](https://aka.ms/hyperscale-tutorial-timeseries)建置這類應用程式的範例。

## <a name="next-steps"></a>後續步驟
- 了解如何[共置](concepts-hyperscale-colocation.md)之間快速執行查詢的分散式的資料可協助
