---
title: 在 Azure Data Factory 的對應資料流程功能中設定來源轉換
description: 瞭解如何在對應的資料流程中設定來源轉換。
author: kromerm
ms.author: makromer
ms.service: data-factory
ms.topic: conceptual
ms.date: 02/12/2019
ms.openlocfilehash: 974ece9cd035ae29ada38f34b7933d86f682194f
ms.sourcegitcommit: 800f961318021ce920ecd423ff427e69cbe43a54
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 07/31/2019
ms.locfileid: "68696222"
---
# <a name="source-transformation-for-mapping-data-flow"></a>對應資料流程的來源轉換 

[!INCLUDE [notes](../../includes/data-factory-data-flow-preview.md)]

「來源」轉換會為數據流設定您的資料來源。 資料流程可以包含一個以上的來源轉換。 設計資料流程時, 一定要從來源轉換開始。

每個資料流程都需要至少一個來源轉換。 視需要新增多個來源, 以完成您的資料轉換。 您可以將這些來源與聯結轉換或聯集轉換聯結在一起。

> [!NOTE]
> 當您進行資料流程的分析時, 會使用取樣設定或 debug source 限制, 從來源讀取資料。 若要將資料寫入至接收, 您必須從「管線資料流程」活動執行資料流程。 

![[來源設定] 索引標籤上的來源轉換選項](media/data-flow/source.png "來源")

將資料流程來源轉換只與一個 Data Factory 資料集產生關聯。 資料集會定義您想要寫入或讀取之資料的形狀和位置。 您可以在來源中使用萬用字元和檔案清單, 一次處理一個以上的檔案。

使用**萬用字元模式**選項會指示 ADF 在單一來源轉換中, 迴圈處理每個相符的資料夾和檔案。 這是在單一流程中處理多個檔案的有效方式。 若要追蹤目前正在處理的檔案名, 請在 [來源選項] 中設定 [要儲存檔案名稱的資料行] 欄位的功能變數名稱。

> [!NOTE]
> 使用現有萬用字元模式旁的 + 符號設定多個萬用字元比對模式, 以新增更多萬用字元規則。

## <a name="data-flow-staging-areas"></a>資料流程臨時區域
資料流程適用于所有 Azure 中的*臨時*資料集。 當您要轉換資料時, 請使用這些資料集進行預備。 

Data Factory 可以存取將近80的原生連接器。 若要在資料流程中包含來自其他來源的資料, 請使用複製活動工具, 在其中一個資料流程資料集臨時區域中暫存該資料。

## <a name="options"></a>選項。

選擇適用于您資料的架構和取樣選項。

### <a name="schema-drift"></a>結構描述漂移
[架構漂移](concepts-data-flow-schema-drift.md)是 ADF 能夠以原生方式處理您資料流程中的彈性架構, 而不需要明確地定義資料行變更。

* 如果來源資料行經常變更, 請選取 [**允許架構漂移**]。 此設定可讓所有傳入的來源欄位流經接收的轉換。

* 選擇 [**推斷漂移資料行類型**] 將會指示 ADF 定義探索到的每個新資料行的資料類型。 關閉這項功能時, ADF 會採用字串。

### <a name="validate-schema"></a>驗證架構

如果來源資料的傳入版本不符合已定義的架構, 資料流程將無法執行。

![公用來源設定, 顯示驗證架構、允許架構漂移和取樣的選項](media/data-flow/source1.png "公用來源 1")

### <a name="sample-the-data"></a>範例資料
啟用**取樣**以限制來源的資料列數目。 當您從來源測試或取樣資料以進行調試時, 請使用此設定。

## <a name="define-schema"></a>定義架構

當您的來源檔案不是強型別 (例如, 一般檔案而不是 Parquet 檔案) 時, 請在來源轉換中定義每個欄位的資料類型。  

![[定義架構] 索引標籤上的來源轉換設定](media/data-flow/source2.png "來源 2")

您稍後可以在 [選取] 轉換中變更資料行名稱。 使用衍生的資料行轉換來變更資料類型。 針對強型別來源, 您可以在稍後的 select 轉換中修改資料類型。 

![選取轉換中的資料類型](media/data-flow/source003.png "資料類型")

### <a name="optimize-the-source-transformation"></a>優化來源轉換

在來源轉換的 [**優化**] 索引標籤上, 您可能會看到**來源**分割區類型。 只有當您的來源是 Azure SQL Database 時, 才可以使用此選項。 這是因為 Data Factory 嘗試讓連接平行處理, 以對您的 SQL Database 來源執行大型查詢。

![來源分割區設定]資料(media/data-flow/sourcepart3.png "分割")

您不需要分割 SQL Database 來源上的資料, 但磁碟分割對於大型查詢很有用。 您可以根據資料行或查詢來建立資料分割的基礎。

### <a name="use-a-column-to-partition-data"></a>使用資料行來分割資料

從您的來源資料表中選取要分割的資料行。 同時設定分割區的數目。

### <a name="use-a-query-to-partition-data"></a>使用查詢來分割資料

您可以選擇根據查詢來分割連接。 只要輸入 WHERE 述詞的內容即可。 例如, 輸入 year > 1980。

## <a name="source-file-management"></a>來源檔案管理

選擇 [設定] 以管理來源中的檔案。 

![新增來源設定](media/data-flow/source2.png "新設定")

* **萬用字元路徑**:從您的來源容器中, 選擇符合模式的一系列檔案。 此設定會覆寫資料集定義中的任何檔案。

萬用字元範例:

* ```*```代表任何一組字元
* ```**```表示遞迴目錄的嵌套
* ```?```取代一個字元
* ```[]```比對括弧中的一個或多個字元

* ```/data/sales/**/*.csv```取得/data/sales 下的所有 csv 檔案
* ```/data/sales/20??/**```取得20世紀的所有檔案
* ```/data/sales/2004/*/12/[XY]1?.csv```取得2004年12月的所有 csv 檔案, 從 X 或 Y 前面加上2位數的數位

容器必須在資料集內指定。 因此, 您的萬用字元路徑也必須包含根資料夾中的資料夾路徑。

* 資料**分割根路徑**:如果您的檔案來源中有已分割的資料夾```key=value``` (也就是 year = 2019), 則您可以要求 ADF 將該分割區資料夾樹狀結構的最上層指派給資料流程資料流程中的資料行名稱。

首先, 設定萬用字元以包含所有分割資料夾的路徑, 加上您想要讀取的分葉檔案。

資料![分割來源檔案設定]資料(media/data-flow/partfile2.png "分割檔案設定")

現在使用 [磁碟分割根路徑] 設定來告訴 ADF 哪個資料夾結構最上層。 現在, 當您查看資料的內容時, 您會看到 ADF 會新增在您的每個資料夾層級中找到的已解析磁碟分割。

![分割區根路徑]資料(media/data-flow/partfile1.png "分割根路徑預覽")

* 檔案**清單**:這是檔案集。 建立文字檔, 其中包含要處理的相對路徑檔案清單。 指向這個文字檔。
* **要儲存檔案名稱的資料行**:將原始程式檔的名稱儲存在資料行中。 在此輸入新的名稱以儲存檔案名稱字串。
* **完成後**:選擇在資料流程執行後, 不要對來源檔案執行任何動作、刪除來源檔案, 或移動來源檔案。 移動的路徑是相對的。

若要將原始程式檔移到另一個位置後置處理, 請先選取 [移動] 進行檔案操作。 然後, 設定 "from" 目錄。 如果您的路徑不使用任何萬用字元, 則 "from" 設定將會是與源資料夾相同的資料夾。

如果您有具有萬用字元的來源路徑, 您的語法看起來會像下面這樣:

```/data/sales/20??/**/*.csv```

您可以指定 "from" 作為

```/data/sales```

和 "to" as

```/backup/priorSales```

在此情況下, 所有源自/data/sales 的檔案都會移至/backup/priorSales。

### <a name="sql-datasets"></a>SQL 資料集

如果您的來源是 SQL Database 或 SQL 資料倉儲, 則您有其他選項可用於來源檔案管理。

* **查詢**：對您的來源輸入 SQL 查詢。 此設定會覆寫您在資料集中選擇的任何資料表。 請注意, 這裡不支援**Order By**子句, 但您可以設定完整的 SELECT FROM 語句。 您也可以使用使用者定義資料表函數。 **select * From udfGetData ()** 是 SQL 中傳回資料表的 UDF。 此查詢會產生您可以在資料流程中使用的來源資料表。
* **批次大小**：輸入批次大小, 將大型資料區塊為讀取。
* **隔離等級**:ADF 對應資料流程中 SQL 來源的預設值是讀取未認可。 您可以在這裡將隔離等級變更為下列其中一個值:
* 讀取認可的
* 讀取未認可的
* 可重複讀取
* 可序列化
* 無 (忽略隔離等級)

![隔離等級](media/data-flow/isolationlevel.png "隔離等級")

> [!NOTE]
> 只有當您從管線執行 (管線偵錯工具或執行回合) 啟動資料流程, 而該資料流程使用管線中的「執行資料流程」活動時, 檔案作業才會執行。 檔案作業*不會*在資料流程的「資料流程」 (debug) 模式中執行。

### <a name="projection"></a>投射

如同資料集內的架構, 來源中的投射會定義來源資料的資料行、類型和格式。 

![[投射] 索引標籤上的設定](media/data-flow/source3.png "投射")

如果您的文字檔沒有已定義的架構, 請選取 [偵測**資料類型**], 讓 Data Factory 將會取樣並推斷資料類型。 選取 [**定義預設格式**] 以自動偵測預設資料格式。 

您可以在較新的衍生資料行轉換中修改資料行資料類型。 使用 [選取] 轉換來修改資料行名稱。

![預設資料格式的設定](media/data-flow/source2.png "預設格式")

### <a name="add-dynamic-content"></a>新增動態內容
當您按一下 [設定] 面板中的欄位內部時, 您會看到「新增動態內容」的超連結。 當您選取啟動「運算式產生器」時, 您將會使用運算式、靜態常值或參數來動態設定值。

![參數](media/data-flow/params6.png "參數")

## <a name="next-steps"></a>後續步驟

開始建立[衍生的資料行轉換](data-flow-derived-column.md)和[選取轉換](data-flow-select.md)。
