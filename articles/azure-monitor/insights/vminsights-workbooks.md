---
title: 使用 Azure 監視器的活頁簿中建立互動式報表 |Microsoft Docs
description: 簡化複雜的報告預先定義和自訂參數化的活頁簿與 Azure 監視的 Vm。
services: azure-monitor
documentationcenter: ''
author: mgoedtel
manager: carmonm
editor: ''
ms.assetid: ''
ms.service: azure-monitor
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: infrastructure-services
ms.date: 04/05/2019
ms.author: magoedte
ms.openlocfilehash: 90c236347380bb5d5e51db56d0f431d2659a7258
ms.sourcegitcommit: d4dfbc34a1f03488e1b7bc5e711a11b72c717ada
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 06/13/2019
ms.locfileid: "61387058"
---
# <a name="create-interactive-reports-with-azure-monitor-workbooks"></a>使用 Azure 監視器活頁簿建立互動式報表

活頁簿結合文字 [記錄查詢](../log-query/query-language.md)，度量，以及豐富的互動式報表參數。 活頁簿可以由具有相同 Azure 資源存取權的其他小組成員編輯。

活頁簿是這類情況下很有幫助：

* 如果您事先不知道感興趣的度量，請瀏覽您的虛擬機器的使用方式：CPU 使用率、 磁碟空間、 記憶體、 網路相依性、 等等。不同於其他使用情況分析工具，活頁簿可讓您合併多種類型的視覺效果與分析，更加適合這種自由形式的探索。
* 說明您的小組執行最近佈建的 VM 的方式，可顯示重要的計數器和其他記錄檔事件的度量。
* 與您的小組的其他成員共用您的 VM 調整大小實驗的結果。 您可以說明文字中，實驗的目標，然後顯示每個使用方式計量和分析查詢用來評估實驗，以及清楚圖說的每個計量是否高於-或低於目標。
* 您的 VM，結合資料、 文字說明和下一步的討論以避免中斷在未來的使用方式報告中斷的影響。

適用於 Vm 的 azure 監視器包含數個活頁簿，以協助您入門，以及下表摘要說明。

| 活頁簿 | 描述 | `Scope` |
|----------|-------------|-------|
| 效能 | 提供前 n 個清單和圖表檢視，運用所有您已啟用 Log Analytics 效能計數器的單一活頁簿中的自訂的版本。| 大規模 |
| 效能計數器 | 前 n 個圖表檢視跨一組廣泛的效能計數器。 | 大規模 |
| 連線 | 連線會從受監視的 Vm，可深入檢視輸入和輸出連線。 | 大規模 |
| 使用中的連接埠 | 提供之處理序的繫結至連接埠上的受監視的 Vm 和其所選時間範圍中的活動清單。 | 大規模 |
| 開放連接埠 | 提供受監視的 Vm 上開啟的連接埠的數目和詳細資料的開啟連接埠。 | 大規模 |
| 失败的连接数 | 在受監視的 Vm 失敗趨勢上顯示的連線失敗計數，如果失敗的百分比會隨著時間增加。 | 大規模 |
| 安全性和稽核 | 您整體連線，惡意的連線，IP 端點全域所在的位置的報表中的 TCP/IP 流量分析。  若要啟用所有功能，您必須都啟用安全性偵測。 | 大規模 |
| TCP 流量 | 排名的報表，您受監視的 Vm 和其傳送、 接收，和總計的網路流量在方格中，且顯示為的趨勢線。 | 大規模 |
| 流量比較 | 此活頁簿可讓您比較在單一機器或機器群組的網路流量趨勢。 | 大規模 |
| 效能 | 提供可自訂的版本，我們會利用所有您已啟用 Log Analytics 效能計數器的效能檢視。 | 單一 VM | 
| 連線 | 連線會從您的 VM，可深入檢視輸入和輸出連線。 | 單一 VM |
 
## <a name="starting-with-a-template-or-saved-workbook"></a>以範本或是既有活頁簿為基礎

活頁簿由獨立可編輯的圖表、表格、文字及輸入控制項之區段組成。 若要進一步了解活頁簿，讓我們先開啟範本，並逐步解說建立自訂的活頁簿。 

1. 登入 [Azure 入口網站](https://portal.azure.com)。

2. 選取 [虛擬機器]  。

3. 從清單中選取 VM。

4. 在 VM 頁面的 [監視]  區段中，選取 [Insights (預覽)]  。

5. 在 [VM insights] 頁面中，選取**效能**或是**對應**索引標籤，然後選取**View 的活頁簿**從頁面上的連結。 

    ![瀏覽至活頁簿的螢幕擷取畫面](media/vminsights-workbooks/workbook-option-01.png)

6. 從下拉式清單中，選取**移至資源庫**底部的清單。

    ![活頁簿下拉式清單的螢幕擷取畫面](media/vminsights-workbooks/workbook-dropdown-gallery-01.png)

    它會啟動活頁簿資源庫以預先建置的活頁簿，以協助您開始的數字。

7. 我們先使用**預設範本**，就在**快速入門**標題之下。

    ![活頁簿資源庫螢幕擷取畫面](media/vminsights-workbooks/workbook-gallery-01.png)

## <a name="editing-workbook-sections"></a>編輯活頁簿區段

活頁簿有兩種模式：**編輯模式**和**閱讀模式**。 當第一次啟動預設的範本活頁簿時，它會開啟在**編輯模式**。 它會顯示此活頁簿，包括任何步驟和參數，否則為隱藏的所有內容。 **閱讀模式**呈現簡化的報告樣式檢視畫面。 讀取模式可讓您抽離進入時仍有基礎機制只按幾下，需要進行修改時建立報表的複雜度。

![Azure 監視器 Vm 活頁簿區段編輯控制項](media/vminsights-workbooks/workbook-new-workbook-editor-01.png)

1. 當您完成編輯區段時，按一下**完成編輯**區段左下角。

2. 若要建立區段的複本，按一下 [複製此區段]  圖示。 建立重複的區段是逐一查看查詢而不會遺失先前反覆項目的絕佳方式。

3. 若要在活頁簿中將區段上移，按一下 [上移]  或 [下移]  圖示。

4. 若要永久移除區段，按一下 [移除]  圖示。

## <a name="adding-text-and-markdown-sections"></a>新增文字和 Markdown 區段

將標題、說明及註解新增至您的活頁簿，可協助將一組資料表和圖表變成敘述。 活頁簿中的文字區段支援 [Markdown 語法](https://daringfireball.net/projects/markdown/)以進行文字格式設定，例如標題、粗體、斜體和項目符號清單。

若要將文字區段新增至您的活頁簿，請使用活頁部底端或任何區段底端的 [新增文字]  按鈕。

## <a name="adding-query-sections"></a>加入查詢區段

![活頁簿中的查詢區段](media/vminsights-workbooks/005-workbook-query-section.png)

若要將查詢區段新增至您的活頁簿，請使用活頁部底端或任何區段底端的 [新增查詢]  按鈕。

查詢區段十分有彈性，可以用以回答下述問題：

* 我的 CPU 使用率期間的網路流量增加的相同時間期間的如何？
* 在過去一個月是什麼的趨勢可用磁碟空間？
* 我的 VM 未經歷網路的連線失敗次數過去兩週內？ 

您也只限於從虛擬機器的內容查詢啟動的活頁簿。 只要您有這些資源的存取權，您可以跨多個虛擬機器，以及 Log Analytics 工作區進行查詢。

若要包含從其他 Log Analytics 工作區，或從特定的 Application Insights 的應用程式使用的資料**工作區**識別項。 若要深入了解跨資源的查詢，請參閱[官方指引](../log-query/cross-workspace-query.md)。

### <a name="advanced-analytic-query-settings"></a>進階分析查詢設定

每個區段都有它自己的進階的設定，也就是透過設定存取![活頁簿區段編輯控制項](media/vminsights-workbooks/006-settings.png)圖示位於右邊**將參數加入** 按鈕。

![Azure 監視器 Vm 活頁簿區段編輯控制項](media/vminsights-workbooks/007-settings-expanded.png)

|         |          |
| ---------------- |:-----|
| **自訂寬度**    | 讓項目任意的大小，因此您可以讓您進一步將您的圖表和資料表組織成豐富的互動式報表該行單一容納多個項目。  |
| **依條件顯示** | 指定要隱藏參數為基礎時在閱讀模式中的步驟。 |
| **匯出參數**| 允許選取的資料列，在格線或圖表，讓稍後的步驟，變更值或顯示出來。  |
| **在未編輯時顯示查詢** | 在閱讀模式中顯示上述圖表或甚至是資料表查詢。
| **在未進行編輯時顯示 [在分析中開啟] 按鈕** | 將允許單鍵存取圖表右上角的藍色的 [分析] 圖示。|

大部分的設定項目都很直覺，但要了解**匯出參數**，最好檢視使用此一功能之活頁簿。

其中一個預先建立的活頁簿- **TCP 流量**，提供連線計量來自 VM 的資訊。

活頁簿的第一個區段根據記錄檔查詢資料。 第二個區段也根據記錄檔查詢資料，但第一個資料表中選取資料列會以互動方式更新圖表的內容：

![Azure 監視器 Vm 活頁簿區段編輯控制項](media/vminsights-workbooks/008-workbook-tcp-traffic.png)

行為可透過善用**選取項目時，匯出參數**進階設定，請啟用資料表的記錄檔查詢中。

![Azure 監視器 Vm 活頁簿區段編輯控制項](media/vminsights-workbooks/009-settings-export.png)

第二個記錄檔查詢會建立一組值，然後由區段標題和圖表中選取一個資料列時，接著使用匯出的值。 如果未不選取任何資料列，則它會隱藏區段標題和圖表。 

例如，在第二個區段中隱藏的參數會使用方格中選取的資料列中的下列參考：

```
VMConnection
| where TimeGenerated {TimeRange}
| where Computer in ("{ComputerName}") or '*' in ("{ComputerName}") 
| summarize Sent = sum(BytesSent), Received = sum(BytesReceived) by bin(TimeGenerated, {TimeRange:grain})
```

## <a name="adding-metrics-sections"></a>新增計量區段

計量區段讓您能存取所有 Azure 監視器計量資料，納入您的互動式報表中。 在 Azure 監視器中的 Vm，分析查詢資料，而不是計量資料，通常會包含預先建置的活頁簿。  您可以選擇使用計量資料，建立活頁簿可讓您充分利用最佳的這兩項功能在同一處。 您也可以從任何可存取之訂閱的資源，提取計量資料。

正在提取至活頁簿提供格線的視覺效果的 CPU 效能的虛擬機器資料的範例如下：

![Azure 監視器 Vm 活頁簿區段編輯控制項](media/vminsights-workbooks/010-metrics-grid.png)

## <a name="adding-parameter-sections"></a>新增參數區段

活頁簿參數讓您不需要手動編輯查詢或文字區段，便能改變活頁簿的值。 這樣便不需要了解其中分析查詢的語言，大幅拓展以活頁簿為基礎之報表潛在的觀眾。

將參數的名稱放在括弧中，像是 ``{parameterName}``，來取代查詢、文字、或其他參數區段中參數的值。 參數名稱僅限於 JavaScript 識別碼、 字母字元或底線，後面接著英數字元或底線為類似的規則。 舉例來說，**a1** 是可用的名稱，但 **1a** 則不被允許。

參數是線性的，從活頁簿最頂端往後面的步驟移動。  稍後在活頁簿中宣告的參數可以覆寫稍早宣告的參數。 這也可讓使用查詢來存取從稍早定義的參數的值的參數。 在單一參數步驟中，參數也是線性的，順序從左到右，右邊的參數可以仰賴同一步驟中已經宣告的參數。
 
有四種不同類型目前支援的參數：

|                  |      |
| ---------------- |:-----|
| **Text**    | 可讓使用者編輯文字 方塊中，以及您可以選擇性地提供查詢來填入預設值。 |
| **下拉式清單** | 可讓使用者選擇從一組值。 |
| **時間範圍選擇器**| 可讓使用者選擇一組預先定義的時間範圍值，或挑選自訂時間範圍。|
| **資源選擇器** | 可讓使用者選擇從活頁簿中選取的資源。|

### <a name="using-a-text-parameter"></a>使用文字參數

在文字方塊中的使用者輸入會直接在查詢中，不含逸出或加註引號於取代值。 如果您需要的值為字串，查詢中必須在參數前後加上引號 (像是 **'{parameter}'** )。

文字參數可讓您在文字方塊中，若要在任何地方使用的值。 可以用於表格名稱、資料行名稱、函數名稱、運算子等等。文字參數型別具有值**從分析查詢取得預設值**，這可讓活頁簿作者使用查詢來填入該文字方塊的預設值。

使用預設值時記錄查詢中，第一個資料列 （0 欄中的 資料列 0） 的第一個值可做為預設值。 因此建議您將查詢限制為只傳回一行一列。 查詢所傳回的任何其他資料會被忽略。 

查詢傳回的任何值都將會直接被取代為不含逃脫字元或引號的版本。 若查詢未傳回任何資料列，參數之結果將為空白字串 (若參數並非必須) 或未定義 (若參數為必須)。

### <a name="using-a-drop-down"></a>使用下拉式清單

下拉式清單中的參數型別可讓您建立下拉式清單控制項，讓您選取一或多個值。

下拉式清單中會填入記錄查詢或 JSON。 如果查詢傳回一個資料行，該資料行中的值會是值和下拉式清單控制項中的標籤。 如果查詢會傳回兩個資料行，第一個資料行的值，而第二個資料行下拉式清單中顯示的標籤。 如果查詢傳回三個資料行，第三個資料行用來表示該下拉式清單中的預設選取項目。 此一資料行可以為任何型別，最簡單的方式是使用布林或數字型別，0 為 false，1 為 true。

若資料行為字串型別，Null/空白字串將被視為 false，其他任何值都視為 true。 單一選取下拉式清單中，針對含有 true 值的第一個值做為預設選取項目。  多個選取項目下拉式清單中，所有值，則為 true 的值會都使用所選取的預設設定。 在下拉式清單中的項目會顯示依任何順序的查詢會傳回資料列。 

讓我們看看連線概觀報表中的參數。 按一下 編輯符號旁**方向**。

![Azure 監視器 Vm 活頁簿區段編輯控制項](media/vminsights-workbooks/011-workbook-using-dropdown.png)

這會啟動**編輯參數**功能表項目。

![Azure 監視器 Vm 活頁簿區段編輯控制項](media/vminsights-workbooks/012-workbook-edit-parameter.png)

JSON 可讓您產生填入內容的任意資料表。 例如，下列 JSON 會產生兩個值下拉式清單中：

```
[
    { "value": "inbound", "label": "Inbound"},
    { "value": "outbound", "label": "Outbound"}
]
```

更適用的範例使用下拉式清單可供挑選一組效能計數器名稱：

```
Perf
| summarize by CounterName, ObjectName
| order by ObjectName asc, CounterName asc
| project Counter = pack('counter', CounterName, 'object', ObjectName), CounterName, group = ObjectName
```

查詢如下顯示結果：

![效能計數器的下拉式清單](media/vminsights-workbooks/013-workbook-edit-parameter-perf-counters.png)

下拉式清單是用來自訂及建立互動式報表功能極為強大的工具。

### <a name="time-range-parameters"></a>時間範圍參數

雖然您可以使用下拉式參數型別來建立您自己自訂的時間範圍參數，若您不需要自訂參數所提供的彈性，您也可以使用已經建立好的時間範圍參數型別。 

時間範圍參數型別有 15 種預設範圍，短至五分鐘，長至 90 天。 您還可以選擇允許自訂時間範圍選取，讓報表的操作者能指定時間範圍的起始值及終止值。

### <a name="resource-picker"></a>資源選擇器

資源選擇器參數型別讓您能根據特定資源類型設定報表範圍。 預先建立的活頁簿，運用資源選擇器類型的範例**效能**活頁簿。

![工作區 下拉式清單](media/vminsights-workbooks/014-workbook-edit-parameter-workspaces.png)

## <a name="saving-and-sharing-workbooks-with-your-team"></a>儲存活頁簿並且與小組共用

活頁簿會儲存在 Log Analytics 工作區或虛擬機器資源，取決於活頁簿資源庫的存取方式。 活頁簿可以儲存至**我的報表**給您，或在私用 區段**共用報表**與資源的存取權給所有人存取的區段。 若要檢視資源中的所有活頁簿，請按一下動作列中的 [開啟]  按鈕。

若要共用目前在 [我的報表]  的活頁簿：

1. 按一下動作列中的 [開啟] 
2. 按一下您想要共用之活頁簿旁邊的 [...] 按鈕
3. 按一下 [移至共用報表]  。

若要使用連結或透過電子郵件共用活頁簿，請按一下動作列中的 [共用]  。 請注意，連結的收件者需要在 Azure 入口網站中存取此資源的存取權，才能檢視活頁簿。 若要進行編輯，收件者至少需要資源的參與者權限。

若要將活頁簿的連結釘選到 Azure 儀表板：

1. 按一下動作列中的 [開啟] 
2. 按一下您想要釘選之活頁簿旁邊的 [...] 按鈕
3. 按一下 [釘選到儀表板]  。

## <a name="next-steps"></a>後續步驟
若要了解如何使用健全狀況的功能，請參閱[檢視 Azure VM 的健康狀態](vminsights-health.md)，或若要檢視探索到的應用程式相依性，請參閱[Vm 對應的檢視 Azure 監視器](vminsights-maps.md)。 